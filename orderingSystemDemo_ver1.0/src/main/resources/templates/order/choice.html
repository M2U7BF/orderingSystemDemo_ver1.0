<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>購入食材の選択</title>
    <link rel="stylesheet" href="../css/style.css">
    <script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
    <script src="../js/ordering.choice.js"></script>
</head>

<body>
    <h1>購入食材の選択</h1>
    <div>
        <p>購入者 : <span th:text="${user.name}">購入者の名前</span></p>
    </div>
    <h2>食材一覧</h2>
    <div>
        <p>今の時期に流通している主な食材を表示しています。<br>表記のない食材についてはこちらにてご注文ください。</p><br>
        <p>追加するにはクリックをしてください。</p>
    </div>
    <h3>野菜</h3>
    <table>
        <tr>
            <th>番号
                <a href="">▼</a>
            </th>
            <th>
                食材名
                <a href="">▼</a>
            </th>
            <th>単位</th>
            <th>値段(円)</th>
        </tr>
        <!-- TODO 今の季節に取り扱う食材をリストで入手 -->
        <th:block th:each="veg : ${vegetables}">
            <tr class="foodListItem" data-id="0" th:data-id="*{id}" th:object="${veg}" onclick="showSelectedItem(this)">
                <td class="id" th:text="*{id}">番号</td>
                <td class="name" th:text="*{name}">食材名</td>
                <td class="salesUnit" th:text="*{salesUnit}">取り扱い単位</td>
                <td class="price" th:text="*{price}">値段</td>
            </tr>
        </th:block>
    </table>
    <h3>果物</h3>
    <table>
        <tr>
            <th>番号</th>
            <th>食材名</th>
            <th>単位</th>
            <th>値段(円)</th>
        </tr>
        <th:block th:each="frt : ${fruits}">
            <tr class="foodListItem" data-id="0" th:data-id="*{id}" th:object="${frt}" onclick="showSelectedItem(this)">
                <td class="id" th:text="*{id}">番号</td>
                <td class="name" th:text="*{name}">食材名</td>
                <td class="salesUnit" th:text="*{salesUnit}">取り扱い単位</td>
                <td class="price" th:text="*{price}">値段</td>
            </tr>
        </th:block>
    </table>
    <!-- TODO デフォルト、選択していませんの表示 -->
    <h2>選択した食材</h2>
    <form action="" th:action="@{/order/confirm}" method="post">
        <table id="selectedList">
            <tr>
                <th>番号</th>
                <th>食材名</th>
                <th>単位</th>
                <th>値段(円)</th>
                <th>購入個数</th>
                <th>購入金額(円)(税抜)</th>
            </tr>
            <th:block th:each="price ,iter : ${orderForm.price}">
                <tr class="selectedItem" th:id="|selectedItem${orderForm.id[iter.index]}|">
                    <td th:text="${orderForm.id[iter.index]}">id</td>
                    <td th:text="${orderForm.name[iter.index]}">name</td>
                    <td th:text="${orderForm.salesUnit[iter.index]}">salesUnit</td>
                    <td th:text="${orderForm.price[iter.index]}">price</td>
                    <td>
                        <select name="numPurchase" th:id="|numPurchases${orderForm.numPurchase[iter.index]}|" th:onchange="calcTotal([[${orderForm.price[iter.index]}]],[[${orderForm.numPurchase[iter.index]}]])" placeholder="個数">
                            <option th:each="i: ${#numbers.sequence(0, 15)}" th:selected="${i} == ${orderForm.numPurchase[iter.index]}"  th:text="${i}">0</option>
                        </select>
                    </td>
                    <td><span th:text="${orderForm.total[iter.index]}" th:id="|total${orderForm.numPurchase[iter.index]}|" class="total">0</span></td>
                    <td><button th:onclick="removeItem(this,[[${orderForm.numPurchase[iter.index]}]])" class="deleteButton">削除する</button></td>
            </tr>
            <input type="hidden" field="id" name="id" th:value="${orderForm.id[iter.index]}">
            <input type="hidden" field="name" name="name" th:value="${orderForm.name[iter.index]}">
            <input type="hidden" field="salesUnit" name="salesUnit" th:value="${orderForm.salesUnit[iter.index]}">
            <input type="hidden" field="price" name="price" th:value="${orderForm.price[iter.index]}">
            <input type="hidden" field="numPurchase" name="numPurchase" th:value="${orderForm.numPurchase[iter.index]}">
            <input type="hidden" field="total" name="total" th:value="${orderForm.total[iter.index]}">
            <input type="hidden" field="grandTotal" name="grandTotal" th:value="${orderForm.grandTotal}">
            </th:block>
        </table>
        <h2>合計:
            <span id="grandTotal" th:text="${orderForm.grandTotal} == null ? 0 : ${orderForm.grandTotal}">合計金額</span>円(税込み)
            <input id="grandTotal_input" type="hidden" name="grandTotal" value="0">
        </h2>

        <input id="submit" type="submit" value="確認画面に進む">
    </form>

    <a href="service.html" th:href="@{/order/cancel}">戻る</a></li>
</body>

</html>